<cfif IsDefined("URL.source")>
	<cfset SESSION.source = URL.source>
<cfelse>
	<cfif NOT IsDefined("SESSION.source")>
    	<cfset SESSION.source = "Undefined">
    </cfif>
</cfif>
<cfif IsDefined("FORM.activate") AND FORM.activate IS "1">
  <cfset nosend = 0>
  <!--- Form check --->
  <cfif Trim(FORM.fname) IS "">
    <cfset fname_msg = "Required">
    <cfset nosend = 1>
  </cfif>
  <cfif Trim(FORM.lname) IS "">
    <cfset lname_msg = "Required">
    <cfset nosend = 1>
  </cfif>
  <cfif Trim(FORM.email) IS "">
    <cfset email_msg = "Required">
    <cfset nosend = 1>
    <cfelse>
    <cfif REFindNoCase(
"^[_a-z0-9-]+(\.[_a-z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*\.(([a-z]{2,3})|(aero|coop|info|museum|name))$",
FORM.email) EQ 0>
      <cfset email_msg = "Invalid">
      <cfset nosend = 1>
    </cfif>
  </cfif>
   <cfif Trim(FORM.address) IS "">
    <cfset address_msg = "Required">
    <cfset nosend = 1>
  </cfif>
  <cfif Trim(FORM.city) IS "">
    <cfset city_msg = "Required">
    <cfset nosend = 1>
  </cfif>
  <cfif Trim(FORM.state) IS "">
    <cfset state_msg = "Required">
    <cfset nosend = 1>
  </cfif>
  <cfif Trim(FORM.zip) IS "">
    <cfset zip_msg = "Required">
    <cfset nosend = 1>
  </cfif>
  <cfif Trim(FORM.phone) IS "">
    <cfset phone_msg = "Required">
    <cfset nosend = 1>
  </cfif>
  <cfif Trim(FORM.message) IS "">
    <cfset message_msg = "Required">
    <cfset nosend = 1>
  </cfif>
  <cfif nosend EQ 0>
    <cfquery name="GetMarketArea" datasource="regionalmarketing">
    SELECT market, area
    FROM zips_markets_areas
    WHERE zip = '#FORM.zip#'
    </cfquery>
    <cfif GetMarketArea.RecordCount GT 0>
      <cfswitch expression="#GetMarketArea.market#">
        <cfcase value="East">
        <cfset email_name = "Michael Napier">
        <cfset email_list="michael.napier@twcable.com">
        </cfcase>
        <cfcase value="New York City">
        <cfset email_name = "Thomas Koo">
        <cfset email_list="thomas.koo@twcable.com">
        </cfcase>
        <cfcase value="Northeast">
        <cfset email_name = "David Washburn">
        <cfset email_list="david.washburn@twcable.com">
        </cfcase>
        <cfdefaultcase>
        <cfset email_name = "">
        <cfset email_list = "">
        </cfdefaultcase>
      </cfswitch>
      <cfif email_list IS NOT "">
        <cfmail to="#email_list#" from="no-reply@twcable.com"  failto="michael.napier@twcable.com" Subject="Email from twc.com">
To: #email_name#

From: #FORM.fname# #FORM.lname#
Email: #FORM.email#
Address: #FORM.address#
         #FORM.city#, #FORM.state# #FORM.zip#
Phone: #FORM.phone#
Account number: #FORM.account_num#

Message:
#FORM.message#
        </cfmail>
        <cfset msg="Thank you for your email.">
        <!--- INSERT INTO DATABASE --->
        <cfquery name="InsertInquiry" datasource="regionalmarketing">
        INSERT INTO contact
        (fname, lname, email, address, city, state, zip, phone, account_num, message, submit_date, source, recipient, recipient_email, market, area)
        VALUES ('#FORM.fname#', '#FORM.lname#', '#FORM.email#', '#FORM.address#', '#FORM.city#', '#FORM.state#', '#FORM.zip#', '#FORM.phone#', '#FORM.account_num#', '#FORM.message#', GETDATE(), '#FORM.source#', '#email_name#', '#email_list#', '#GetMarketArea.market#', '#GetMarketArea.area#')        
        </cfquery>
        <cfelse>
        <cfset msg="We're sorry, but you are requesting assistance from an area not serviced by Time Warner Cable.">
      </cfif>
      <cfelse>
      <cfset msg="We're sorry, but you are requesting assistance from an area not serviced by Time Warner Cable.">
    </cfif>
  </cfif>
</cfif>
<html>
<head>
<title>Contact Customer Care</title>
<link rel="stylesheet" href="/TWC/core/css/main.css">
<link rel="stylesheet" href="css/page.css">
</head>
<body>

<div class="container">
	
	<h6>Contact Customer Care</h6>
	
	<section class="row">
		
		<article class="col span_9">  
			<cfif IsDefined("FORM.activate") AND FORM.activate EQ 1 AND IsDefined("nosend") AND nosend EQ 0>
				<cfoutput>#msg#</cfoutput>
				<cfelse> 
				    <form>
				    	<div class="formRow">
				    		<div class="formItem left">
				    			<label class="required">First Name*</label>
				    			<cfif IsDefined("fname_msg")>
					    			<cfoutput>
					    				<span class="error">#fname_msg#</span>
					    			</cfoutput>
					    		</cfif>
				    			<input name="first_name" type="text" tabindex="1" required="" <cfif IsDefined("FORM.fname")>value="<cfoutput>#FORM.fname#</cfoutput>"</cfif>>
				    		</div>
				    		
				    		<div class="formItem right">
				    			<label class="required">Last Name*</label>
				    			<cfif IsDefined("fname_msg")>
					    			<cfoutput>
					    				<span class="error">#lname_msg#</span>
					    			</cfoutput>
					    		</cfif>
				    			<input name="last_name" type="text" tabindex="1" required="" <cfif IsDefined("FORM.lname")>value="<cfoutput>#FORM.lname#</cfoutput>"</cfif>>
				    		</div>
				    	</div>
				    	
				    	<div class="formRow">
				    		<div class="formItem left">
				    			<label class="required">Service Address</label>
				    			<cfif IsDefined("address_msg")>
					    			<cfoutput>
					    				<span class="error">#address_msg#</span>
					    			</cfoutput>
					    		</cfif>
				    			<input name="address" type="text" tabindex="1" required="" <cfif IsDefined("FORM.address")>value="<cfoutput>#FORM.address#</cfoutput>"</cfif>>
				    		</div>
				    		
				    		<div class="formItem right">
				    			<label class="required">City</label>
				    			<cfif IsDefined("city_msg")>
					    			<cfoutput>
					    				<span class="error">#city_msg#</span>
					    			</cfoutput>
					    		</cfif>
				    			<input name="city" class="left" type="text" tabindex="1" required="" <cfif IsDefined("FORM.city")>value="<cfoutput>#FORM.city#</cfoutput>"</cfif>>
				    		</div>
				    	</div>
				    	
				    	<div class="formRow">
				    		<div class="formItem left">
				    			<div class="formItem left">
					    			<label class="required">State*</label>
					    			<cfif IsDefined("state_msg")>
					    				<cfoutput>
					    					<span class="error">#state_msg#</span>
					    				</cfoutput>
					    			</cfif>
					    			<input name="state" type="text" tabindex="1" required="" <cfif IsDefined("FORM.state")>value="<cfoutput>#FORM.state#</cfoutput>"</cfif>>
				    			</div>
				    			<div class="formItem right">	
					    			<label class="required">Zip*</label>
					    			<cfif IsDefined("zip_msg")>
					    				<cfoutput>
					    					<span class="error">#zip_msg#</span>
					    				</cfoutput>
					    			</cfif>
					    			<input name="zip" type="text" tabindex="1" required="" <cfif IsDefined("FORM.zip")>value="<cfoutput>#FORM.zip#</cfoutput>"</cfif>>
				    			</div>
				    		</div>
				    		
				    		<div class="formItem right">
				    			<label class="required">Email Address*</label>
				    			<cfif IsDefined("email_msg")>
					    			<cfoutput>
					    				<span class="error">#email_msg#</span>
					    			</cfoutput>
					    		</cfif>
				    			<input name="email" type="text" tabindex="1" required="" <cfif IsDefined("FORM.email")>value="<cfoutput>#FORM.email#</cfoutput>"</cfif>>
				    		</div>
				    	</div>
				    		
				    	<div class="formRow">
				    		<div class="formItem left">
				    			<label class="required">Phone Number*</label>
				    			<cfif IsDefined("phone_msg")>
					    			<cfoutput>
					    				<span class="error">#phone_msg#</span>
					    			</cfoutput>
					    		</cfif>
				    			<input name="phone" type="text" tabindex="1" required="" <cfif IsDefined("FORM.phone")>value="<cfoutput>#FORM.phone#</cfoutput>"</cfif>>
				    		</div>
				
				    		<div class="formItem right">
				    			<label class="required">Account Number</label>
				    			<input name="account_num" type="text" tabindex="1" <cfif IsDefined("FORM.account_num")>value="<cfoutput>#FORM.account_num#</cfoutput>"</cfif>>
				    		</div>
				    	</div>
				    	
				    	<div class="formRow">
				    		<div class="formItem left">
				    		<label class="required">Message*</label>
				    		<cfif IsDefined("message_msg")>
				    			<cfoutput>
				    				<span class="error">#message_msg#</span>
				    			</cfoutput>
				    		</cfif>
				    		<textarea name="message" maxlength="1500">
				    			<cfif IsDefined("FORM.message")>
				    				<cfoutput>#FORM.message#</cfoutput>
				    			</cfif>
				    		</textarea>
				    		</div>
				    	</div>
				    	
				    	<div class="formRow">
				    		<button class="twc-blue-button" type="submit" name="submit">Submit</button>
				    		<button class="twc-blue-button" type="reset" name="reset">Clear</button>
				    	</div>
				    </form>
			</cfif>
		</article>
	</section>
</div>

</body>
</html>